
process {
    withLabel: "with_cpus" {
        executor            = "slurm"
        cpus                = 32 // Takes about an hour max for each run
        memory              = "48G" // Max has been 37.43 GB but using 48GB to prevent OOM error
    }

    withLabel: "with_gpus" {
        executor            = "slurm"
        /*
        * GPU handles much of the computational load
        * High cpus to prevent allocation of multiple processes to the same node resulting in
        * failure due to GPU OOM error.
        */
        cpus                = 32 // Doesn't need a lot of CPUs.
        memory              = "10G" // Doesn not use a lot of memory
        time                = "6h" // prevent timeout error. Default cluster time is 3h.
        /*
        * Specifies partition -- https://docs.ilifu.ac.za/#/tech_docs/running_jobs?id=notes-for-gpu-jobs
        */
        queue               = "GPU"
        containerOptions    = "--nv" // Required for GPU usage with singularity containers
        /*
        * There are 4 ilifu GPU nodes (currently) **not required but may be useful to control usage
        */
        // maxForks            = 1
    }

    withName: "HyperParameterSearch" {
        cpus                = 32
        memory              = "128G"
        time                = "12h"
    }

    withName: "ModelTestEval" {
        cpus                = 32
        memory              = "128G"
        time                = "6h"
    }
}
